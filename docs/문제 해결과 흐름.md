## 2023-10-15

일단 데이터베이스로 `firestore` 사용할 것이니, `firestore` 연동하는 것부터 해야겠다.
`firestore` 연동하는 방법은 다른 데이터베이스에 비해 꽤 간단하다.

일단

```bash
npm init
npm install firebase
```

로 `firebase` 패키지를 설치한다. 그런 다음, `firebase.js` 파일을 만들자. 여기에다가
`firebase`를 초기화하는 코드를 작성할 것이다.

```js
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";

const firebaseConfig = {
  apiKey: "AIzaSyDXT1hZqqhARm1-z_vR-apuESZSEIipBgc",
  authDomain: "practice-e00a8.firebaseapp.com",
  projectId: "practice-e00a8",
  storageBucket: "practice-e00a8.appspot.com",
  messagingSenderId: "725448911246",
  appId: "1:725448911246:web:55019e69d4599e5e649cdf",
  measurementId: "G-3F8M0H1NG6",
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
```

이게 기본인데, 나는 `firestore sdk`를 사용할 것이기 때문에, `firestore sdk`를 추가해주자.

```js
import * as firestore from "firebase/firestore";
// ...
const db = firestore.getFirestore(app);
```

이제 `firestore`로 내 db에 접근할 수 있다. 테스트로 데이터 하나 넣어보자.

```js
firestore.addDoc(firestore.collection(db, "users"), {
  first: "Ada",
  last: "Lovelace",
  born: 1815,
});
```

오류가 발생했다.

```
[2023-10-15T03:56:51.275Z]  @firebase/analytics: Analytics: Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: (1) Cookies are not available. (analytics/invalid-analytics-context).
file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/analytics/dist/esm/index.esm2017.js:177
    if (Array.isArray(window[dataLayerName])) {
                      ^

ReferenceError: window is not defined
    at getOrCreateDataLayer (file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/analytics/dist/esm/index.esm2017.js:177:23)
    at factory (file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/analytics/dist/esm/index.esm2017.js:1038:9)
    at Component.instanceFactory (file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/analytics/dist/esm/index.esm2017.js:1245:16)
    at Provider.getOrInitializeService (file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/component/dist/esm/index.esm2017.js:290:39)
    at Provider.initialize (file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/component/dist/esm/index.esm2017.js:234:31)
    at initializeAnalytics (file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/analytics/dist/esm/index.esm2017.js:1087:49)
    at getAnalytics (file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/node_modules/@firebase/analytics/dist/esm/index.esm2017.js:1066:12)
    at file:///C:/Users/gusck/node.js%20%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8/practice/nton-video-chat/firebase.js:16:19
    at ModuleJob.run (node:internal/modules/esm/module_job:194:25)

```

`파이어베이스 분석`은 웹브라우저 환경에서만 가능하다고 나와있다. 따라서 지금은 노드 환경이니까 window가 없다고 에러를 던지는 것 같다. 그러므로 분석을 끄고 한번 더 실행해보자.

```js
import { getAnalytics } from "firebase/analytics";
const analytics = getAnalytics(app);
```

이 두 부분을 firebase.js 파일에서 제거해주자.

성공!

![Alt text](./image.png)

데이터가 잘 들어가는 모습이다.

다음으로 해야할 것은 이제 express 환경을 세팅하고 socket.io를 연동하자.
